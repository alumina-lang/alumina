use std::io::stdout;

fn test_read_through_punned_pointer() {
    const VALUE: u32 = {
        let x: u32 = 0x12345678;
        let ptr = &x as &[u8; 4];
        (*ptr)[0] as u32
    };

    std::io::eprintln!("Read byte from u32: 0x{:02x}", VALUE);
}

fn test_write_through_punned_pointer() {
    const VALUE: u32 = {
        let mut x: u32 = 0x12345678;
        let ptr = &mut x as &mut [u8; 4];
        (*ptr)[0] = 0xAB;
        x
    };

    std::io::eprintln!("Modified u32: 0x{:08x}", VALUE);
}

fn test_array_to_primitive() {
    const VALUE: u32 = {
        let arr: [u8; 4] = [0x78, 0x56, 0x34, 0x12];
        let ptr = &arr as &u32;
        *ptr
    };

    std::io::eprintln!("Array to u32: 0x{:08x}", VALUE);
}

fn test_float_to_int() {
    const VALUE: u32 = {
        let f: f32 = 1.0;
        let ptr = &f as &u32;
        *ptr
    };

    std::io::eprintln!("Float 1.0 as bits: 0x{:08x}", VALUE);
}

fn main() {
    test_read_through_punned_pointer();
    test_write_through_punned_pointer();
    test_array_to_primitive();
    test_float_to_int();

    std::io::eprintln!("All type punning tests passed!");
}
